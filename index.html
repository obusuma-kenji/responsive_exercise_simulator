<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIé§†å‹•å‹ è‡¨åºŠé‹å‹•å‡¦æ–¹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <style>
        /* åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        :root {
            --primary-color: #4a69bd;
            --secondary-color: #6a89cc;
            --accent-color: #f6b93b;
            --success-color: #78e08f;
            --warning-color: #f8c291;
            --danger-color: #e55039;
            --light-bg: #f5f6fa;
            --dark-text: #2c3e50;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            background: var(--light-bg);
            min-height: 100vh;
            color: var(--dark-text);
            padding: 10px;
        }

        /* ã‚³ãƒ³ãƒ†ãƒŠã¨ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 { 
            font-size: clamp(1.5rem, 4vw, 2.2rem); 
            margin-bottom: 10px; 
        }
        .header p { 
            opacity: 0.9; 
            font-size: clamp(0.9rem, 2.5vw, 1.1rem); 
            line-height: 1.4;
        }

        /* ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        .game-content {
            display: grid;
            gap: 15px;
            padding: 15px;
        }

        /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—: 3åˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        @media (min-width: 1200px) {
            .game-content {
                grid-template-columns: 350px 1fr 400px;
                padding: 20px;
                gap: 20px;
            }
        }

        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ: ç¸¦ç©ã¿ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        @media (min-width: 768px) and (max-width: 1199px) {
            .game-content {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "client"
                    "planner"
                    "results";
            }
            .client-info { grid-area: client; }
            .weekly-planner { grid-area: planner; }
            .results-panel { grid-area: results; }
        }

        /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³: ç¸¦ç©ã¿ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        @media (max-width: 767px) {
            body { padding: 5px; }
            .container { border-radius: 10px; }
            .header { padding: 15px 10px; }
            .game-content {
                grid-template-columns: 1fr;
                padding: 10px;
                gap: 15px;
            }
        }

        /* ãƒ‘ãƒãƒ«å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .panel {
            background: #ffffff;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
        }

        @media (max-width: 767px) {
            .panel {
                padding: 15px;
                border-radius: 10px;
            }
        }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ« - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        .modal-backdrop {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            width: 100%;
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        @media (max-width: 767px) {
            .modal-content {
                padding: 20px;
                border-radius: 10px;
                margin: 10px;
            }
        }

        .modal-content h3 { 
            margin-bottom: 20px; 
            font-size: clamp(1.1rem, 3vw, 1.3rem);
        }
        .modal-form-group { margin-bottom: 15px; }
        .modal-form-group label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: bold; 
            font-size: clamp(0.9rem, 2.5vw, 1rem);
        }
        .modal-form-group input { 
            width: 100%; 
            padding: 12px; 
            border-radius: 8px; 
            border: 1px solid #bdc3c7; 
            font-size: 16px; /* iOS ã§ã‚ºãƒ¼ãƒ ã‚’é˜²ã */
        }

        /* å·¦ãƒ‘ãƒãƒ«ï¼šã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ± */
        .client-info h3 { 
            border-left: 5px solid var(--primary-color); 
            padding-left: 10px; 
            margin-bottom: 20px; 
            font-size: clamp(1.1rem, 3vw, 1.3rem);
        }
        .client-detail { 
            margin-bottom: 12px; 
            line-height: 1.6; 
            font-size: clamp(0.9rem, 2.5vw, 1rem);
        }
        .client-detail strong { 
            display: inline-block; 
            width: auto;
            min-width: 80px;
        }
        
        @media (max-width: 767px) {
            .client-detail strong {
                display: block;
                margin-bottom: 2px;
            }
        }

        .client-medical-info { 
            background: var(--light-bg); 
            border-radius: 8px; 
            padding: 15px; 
            margin-top: 15px; 
        }
        .client-medical-info h4 { 
            margin-bottom: 10px; 
            font-size: clamp(1rem, 2.5vw, 1.1rem);
        }
        .client-notes { 
            border-top: 1px dashed #ccc; 
            padding-top: 15px; 
            margin-top: 15px; 
            font-style: italic; 
        }

        /* ä¸­å¤®ãƒ‘ãƒãƒ«ï¼šé€±é–“ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ */
        .weekly-planner h3 { 
            text-align: center; 
            margin-bottom: 20px; 
            font-size: clamp(1.1rem, 3vw, 1.3rem);
        }

        .weekly-calendar {
            display: grid;
            gap: 8px;
            margin-bottom: 20px;
        }

        /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—: 7åˆ— */
        @media (min-width: 1200px) {
            .weekly-calendar {
                grid-template-columns: repeat(7, 1fr);
                gap: 10px;
            }
        }

        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ: 7åˆ—ï¼ˆå°‘ã—ç‹­ã‚ï¼‰ */
        @media (min-width: 768px) and (max-width: 1199px) {
            .weekly-calendar {
                grid-template-columns: repeat(7, 1fr);
            }
        }

        /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³: ç¸¦ç©ã¿ */
        @media (max-width: 767px) {
            .weekly-calendar {
                grid-template-columns: 1fr;
            }
        }

        .day-column {
            background: var(--light-bg);
            border-radius: 12px;
            padding: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 200px;
        }

        @media (min-width: 768px) {
            .day-column {
                min-height: 300px;
            }
        }

        @media (min-width: 1200px) {
            .day-column {
                min-height: 400px;
            }
        }

        @media (max-width: 767px) {
            .day-column {
                min-height: 120px;
                display: flex;
                flex-direction: column;
            }
        }

        .day-column.active { 
            border-color: var(--primary-color); 
            background: #e9eefb; 
        }

        .day-header { 
            font-weight: bold; 
            text-align: center; 
            padding: 8px; 
            border-radius: 8px; 
            background: #e1e8f0; 
            margin-bottom: 10px; 
            font-size: clamp(0.9rem, 2.5vw, 1rem);
        }

        .day-exercises { 
            flex-grow: 1;
            position: relative; 
        }

        .day-exercise-item {
            background: #d1e7dd;
            border-left: 4px solid #27ae60;
            border-radius: 4px;
            padding: 6px 8px;
            margin-bottom: 6px;
            font-size: clamp(0.75rem, 2vw, 0.8rem);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            line-height: 1.3;
        }

        .day-exercise-item .remove-btn { 
            color: var(--danger-color); 
            font-weight: bold; 
            cursor: pointer; 
            padding: 2px 4px;
            border-radius: 3px;
            transition: background 0.2s;
        }

        .day-exercise-item .remove-btn:hover {
            background: rgba(229, 80, 57, 0.1);
        }

        .day-time-total { 
            text-align: center; 
            font-weight: bold; 
            margin-top: 10px; 
            font-size: clamp(0.8rem, 2vw, 0.9rem); 
        }

        .exercise-pool { 
            flex-grow: 1; 
            display: flex; 
            flex-direction: column; 
        }
        .exercise-pool h4 { 
            text-align: center; 
            margin-bottom: 15px; 
            font-size: clamp(1rem, 2.5vw, 1.1rem);
        }

        .exercise-cards {
            flex-grow: 1;
            overflow-y: auto;
            padding: 5px;
            display: grid;
            gap: 10px;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚°ãƒªãƒƒãƒ‰ */
        @media (min-width: 1200px) {
            .exercise-cards {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
        }

        @media (min-width: 768px) and (max-width: 1199px) {
            .exercise-cards {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
        }

        @media (max-width: 767px) {
            .exercise-cards {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
        }

        .exercise-card {
            border: 2px solid #bdc3c7;
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .exercise-card:hover { 
            border-color: var(--primary-color); 
            transform: translateY(-2px); 
        }

        .exercise-name { 
            font-weight: bold; 
            font-size: clamp(0.85rem, 2vw, 0.9rem); 
            margin-bottom: 4px;
        }
        .exercise-type { 
            font-size: clamp(0.7rem, 1.8vw, 0.75rem); 
            color: #7f8c8d; 
        }

        /* å³ãƒ‘ãƒãƒ«ï¼šAIè©•ä¾¡ */
        .results-panel h3 { 
            border-left: 5px solid var(--accent-color); 
            padding-left: 10px; 
            margin-bottom: 20px; 
            font-size: clamp(1.1rem, 3vw, 1.3rem);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        @media (max-width: 480px) {
            .summary-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }

        .summary-box { 
            background: var(--light-bg); 
            padding: 15px; 
            border-radius: 8px; 
        }
        .summary-box .label { 
            font-size: clamp(0.8rem, 2vw, 0.9rem); 
            margin-bottom: 5px; 
        }
        .summary-box .value { 
            font-size: clamp(1.3rem, 4vw, 1.5rem); 
            font-weight: bold; 
        }
        .value.score-excellent { color: var(--success-color); }
        .value.score-good { color: var(--accent-color); }
        .value.score-poor { color: var(--danger-color); }
        
        .feedback-area {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px;
            max-height: 400px;
        }

        .feedback-section { margin-bottom: 20px; }
        .feedback-section h4 {
            padding: 8px 12px;
            border-radius: 5px;
            color: white;
            margin-bottom: 10px;
            font-size: clamp(0.9rem, 2.5vw, 1rem);
        }
        .feedback-section.positive h4 { background-color: var(--success-color); }
        .feedback-section.negative h4 { background-color: var(--danger-color); }
        .feedback-item {
            background: #fff;
            border: 1px solid #eee;
            border-left: 3px solid;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            font-size: clamp(0.85rem, 2vw, 0.9rem);
            line-height: 1.4;
        }
        .feedback-item.positive { border-left-color: var(--success-color); }
        .feedback-item.negative { border-left-color: var(--danger-color); }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ */
        .controls { 
            display: flex; 
            gap: 8px; 
            margin-top: 20px; 
            flex-wrap: wrap;
        }

        @media (max-width: 767px) {
            .controls {
                flex-direction: column;
                gap: 10px;
            }
        }

        .btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: clamp(0.85rem, 2vw, 0.9rem);
            transition: all 0.3s ease;
            flex: 1;
            min-height: 44px; /* ã‚¿ãƒƒãƒãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ */
        }

        @media (min-width: 768px) {
            .btn {
                flex: none;
                min-width: 120px;
            }
        }

        .btn-primary { background: var(--primary-color); color: white; }
        .btn-success { background: var(--success-color); color: white; }
        .btn-danger { background: var(--danger-color); color: white; }
        .btn:hover { opacity: 0.85; transform: translateY(-1px); }
        .btn:active { transform: translateY(0); }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
        .feedback-area::-webkit-scrollbar,
        .exercise-cards::-webkit-scrollbar {
            width: 6px;
        }
        .feedback-area::-webkit-scrollbar-track,
        .exercise-cards::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        .feedback-area::-webkit-scrollbar-thumb,
        .exercise-cards::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        .feedback-area::-webkit-scrollbar-thumb:hover,
        .exercise-cards::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹çŠ¶æ…‹ã®ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ”¹å–„ */
        .btn:focus,
        .exercise-card:focus,
        .day-column:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* å°åˆ·ã‚¹ã‚¿ã‚¤ãƒ« */
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; }
            .controls { display: none; }
            .modal-backdrop { display: none !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ¤– AIé§†å‹•å‹ è‡¨åºŠé‹å‹•å‡¦æ–¹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
            <p>AIãŒç”Ÿæˆã™ã‚‹ãƒªã‚¢ãƒ«ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å¯¾ã—ã€æœ€é©ãªé€±é–“é‹å‹•ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç«‹æ¡ˆãƒ»ææ¡ˆã—ã¾ã—ã‚‡ã†</p>
        </header>
        
        <main class="game-content">
            <section class="panel client-info">
                <h3>ğŸ‘¤ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚«ãƒ«ãƒ†</h3>
                <div id="clientDetails"></div>
            </section>

            <section class="panel weekly-planner">
                <h3>ğŸ“… é€±é–“é‹å‹•ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼</h3>
                <div class="weekly-calendar" id="weeklyCalendar"></div>
                <div class="exercise-pool">
                    <h4>ğŸƒ é‹å‹•ãƒ¡ãƒ‹ãƒ¥ãƒ¼é¸æŠ</h4>
                    <div class="exercise-cards" id="exercisePool"></div>
                </div>
            </section>

            <section class="panel results-panel">
                <h3>ğŸ”¬ AIã«ã‚ˆã‚‹è©•ä¾¡ãƒ»ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</h3>
                <div class="summary-grid">
                    <div class="summary-box">
                        <div class="label">é©åˆã‚¹ã‚³ã‚¢</div>
                        <div class="value score-poor" id="scoreDisplay">0</div>
                    </div>
                    <div class="summary-box">
                        <div class="label">é€±é–“é‹å‹•æ™‚é–“</div>
                        <div class="value" id="totalTimeDisplay">0 åˆ†</div>
                    </div>
                </div>
                <div id="feedback" class="feedback-area">
                    <p style="text-align: center; color: #7f8c8d;">ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã€ã€Œè©•ä¾¡ã‚’ä¾é ¼ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="generateNewClient()">ğŸ”„ æ–°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</button>
                    <button class="btn btn-success" onclick="evaluateProgram()">ğŸ¤ è©•ä¾¡ã‚’ä¾é ¼</button>
                    <button class="btn btn-danger" onclick="clearSelections()">ğŸ—‘ï¸ å…¨ã‚¯ãƒªã‚¢</button>
                </div>
            </section>
        </main>
    </div>

    <div class="modal-backdrop" id="exerciseModal">
        <div class="modal-content">
            <h3 id="modalTitle">é‹å‹•è¨­å®š</h3>
            <div id="modalForm"></div>
            <div class="controls">
                <button class="btn btn-success" id="modalConfirmBtn">è¿½åŠ </button>
                <button class="btn btn-danger" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <script>
        // --- ãƒ‡ãƒ¼ã‚¿å®šç¾© ---

        // é‹å‹•ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆã‚ˆã‚Šè©³ç´°ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ï¼‰
        const exercises = [
            { id: 1, name: "ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°", type: "æœ‰é…¸ç´ ", intensity: 1, equipment: "ãªã—", baseDuration: 1.0, unit: "åˆ†", contra: ["å®‰é™æŒ‡ç¤º"], target: ["å…¨èº«æŒä¹…åŠ›"] },
            { id: 2, name: "ã‚¸ãƒ§ã‚®ãƒ³ã‚°", type: "æœ‰é…¸ç´ ", intensity: 2, equipment: "ãªã—", baseDuration: 1.0, unit: "åˆ†", contra: ["é‡åº¦å¿ƒç–¾æ‚£", "å¤‰å½¢æ€§è†é–¢ç¯€ç—‡"], target: ["å…¨èº«æŒä¹…åŠ›", "å¿ƒè‚ºæ©Ÿèƒ½"] },
            { id: 3, name: "æ°´ä¸­æ­©è¡Œ", type: "æœ‰é…¸ç´ ", intensity: 1, equipment: "ãƒ—ãƒ¼ãƒ«", baseDuration: 1.0, unit: "åˆ†", contra: [], target: ["å…¨èº«æŒä¹…åŠ›", "é–¢ç¯€ä¿è­·"] },
            { id: 4, name: "ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°", type: "æœ‰é…¸ç´ ", intensity: 2, equipment: "è‡ªè»¢è»Š", baseDuration: 1.0, unit: "åˆ†", contra: ["é‡åº¦å¿ƒç–¾æ‚£"], target: ["ä¸‹åŠèº«æŒä¹…åŠ›", "å¿ƒè‚ºæ©Ÿèƒ½"] },
            { id: 5, name: "ãƒã‚§ã‚¢ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ", type: "ç­‹åŠ›", intensity: 1, equipment: "æ¤…å­", baseDuration: 0.1, unit: "å›", contra: [], target: ["å¤§è…¿å››é ­ç­‹", "å¤§è‡€ç­‹"] },
            { id: 6, name: "è‡ªé‡ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ", type: "ç­‹åŠ›", intensity: 2, equipment: "ãªã—", baseDuration: 0.1, unit: "å›", contra: ["å¤‰å½¢æ€§è†é–¢ç¯€ç—‡"], target: ["å¤§è…¿å››é ­ç­‹", "å¤§è‡€ç­‹"] },
            { id: 7, name: "è†ã¤ãè…•ç«‹ã¦ä¼ã›", type: "ç­‹åŠ›", intensity: 1, equipment: "ãªã—", baseDuration: 0.1, unit: "å›", contra: ["è‚©é–¢ç¯€ç—›"], target: ["å¤§èƒ¸ç­‹", "ä¸Šè…•ä¸‰é ­ç­‹"] },
            { id: 8, name: "ãƒ—ãƒ©ãƒ³ã‚¯", type: "ç­‹åŠ›", intensity: 2, equipment: "ãªã—", baseDuration: 1.0, unit: "ç§’", contra: ["é‡åº¦é«˜è¡€åœ§"], target: ["ä½“å¹¹å®‰å®šæ€§"] },
            { id: 9, name: "å…¨èº«ã‚¹ãƒˆãƒ¬ãƒƒãƒ", type: "æŸ”è»Ÿæ€§", intensity: 1, equipment: "ãªã—", baseDuration: 1.0, unit: "åˆ†", contra: ["æ€¥æ€§æœŸç‚ç—‡"], target: ["æŸ”è»Ÿæ€§å‘ä¸Š", "ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³"] },
            { id: 10, name: "ç‰‡è¶³ç«‹ã¡", type: "ãƒãƒ©ãƒ³ã‚¹", intensity: 1, equipment: "ãªã—", baseDuration: 1.0, unit: "ç§’", contra: [], target: ["å¹³è¡¡æ„Ÿè¦š", "è»¢å€’äºˆé˜²"] },
        ];

        // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆç”¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒ¼ãƒ„
        const clientData = {
            names: ["ç”°ä¸­", "ä½è—¤", "éˆ´æœ¨", "é«˜æ©‹", "ä¼Šè—¤"],
            genders: ["ç”·æ€§", "å¥³æ€§"],
            ages: [45, 52, 58, 65, 71, 78],
            goals: ["æ¸›é‡", "å¥åº·ç¶­æŒ", "ç­‹åŠ›å‘ä¸Š", "ç”Ÿæ´»ç¿’æ…£ç—…ã®äºˆé˜²ãƒ»æ”¹å–„", "ãƒªãƒãƒ“ãƒª"],
            conditions: [
                { id: "ãªã—", name: "ç‰¹è¨˜äº‹é …ãªã—", tags: [] },
                { id: "é«˜è¡€åœ§", name: "æœ¬æ…‹æ€§é«˜è¡€åœ§ Iåº¦", tags: ["é«˜è¡€åœ§"], notes: "é™åœ§å‰¤ï¼ˆã‚«ãƒ«ã‚·ã‚¦ãƒ æ‹®æŠ—è–¬ï¼‰ã‚’æœç”¨ä¸­ã€‚æ€¥ãªè¡€åœ§ä¸Šæ˜‡ã«æ³¨æ„ã€‚" },
                { id: "ç³–å°¿ç—…", name: "2å‹ç³–å°¿ç—…", tags: ["ç³–å°¿ç—…"], notes: "è¡€ç³–å€¤ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ãŸã‚é‹å‹•ã‚’å¸Œæœ›ã€‚ä½è¡€ç³–ã«æ³¨æ„ã€‚" },
                { id: "è†ç—›", name: "å¤‰å½¢æ€§è†é–¢ç¯€ç—‡", tags: ["å¤‰å½¢æ€§è†é–¢ç¯€ç—‡"], notes: "å³è†ã«è»½åº¦ã®ç—›ã¿ã‚ã‚Šã€‚é«˜è² è·ãƒ»é«˜ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã®é‹å‹•ã¯é¿ã‘ã‚‹ã€‚" },
                { id: "è…°ç—›", name: "æ…¢æ€§è…°ç—›ç—‡", tags: ["è…°ç—›"], notes: "é•·æ™‚é–“åŒã˜å§¿å‹¢ã§ã„ã‚‹ã¨ç—›ã¿ãŒå‡ºã‚‹ã€‚ä½“å¹¹ã®å®‰å®šæ€§ãŒèª²é¡Œã€‚" },
            ],
            personalities: ["çœŸé¢ç›®ã§è¨ˆç”»çš„", "é£½ãã£ã½ã„ãŒã€æ¥½ã—ã„ã“ã¨ãªã‚‰ç¶šã", "ä»•äº‹ãŒå¤šå¿™ã§æ™‚é–“ãŒä¸è¦å‰‡", "é‹å‹•åˆå¿ƒè€…ã§ä¸å®‰ã‚’æ„Ÿã˜ã¦ã„ã‚‹", "éå»ã«è‡ªå·±æµã§é‹å‹•ã—ã€æ€ªæˆ‘ã‚’ã—ãŸçµŒé¨“ãŒã‚ã‚‹"]
        };

        // --- ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç† ---
        let currentClient = {};
        let weeklyProgram = {};
        let selectedDay = null;

        const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
        const dayDisplayNames = ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'];

        // --- åˆæœŸåŒ–ãƒ»ãƒªã‚»ãƒƒãƒˆå‡¦ç† ---
        function initGame() {
            dayNames.forEach(day => { weeklyProgram[day] = []; });
            generateNewClient();
            renderExercisePool();
        }

        function clearSelections() {
            dayNames.forEach(day => { weeklyProgram[day] = []; });
            renderWeeklyCalendar();
            updateSummary();
            clearFeedback();
        }

        // --- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”Ÿæˆ ---
        function generateNewClient() {
            const baseCondition = clientData.conditions[Math.floor(Math.random() * clientData.conditions.length)];
            currentClient = {
                name: `${clientData.names[Math.floor(Math.random() * clientData.names.length)]}ã•ã‚“`,
                age: clientData.ages[Math.floor(Math.random() * clientData.ages.length)],
                gender: clientData.genders[Math.floor(Math.random() * clientData.genders.length)],
                goal: clientData.goals[Math.floor(Math.random() * clientData.goals.length)],
                condition: baseCondition,
                personality: clientData.personalities[Math.floor(Math.random() * clientData.personalities.length)],
            };
            
            // å¹´é½¢ã«å¿œã˜ãŸé‹å‹•ä¸Šé™ã‚’è¨­å®š
            if (currentClient.age > 65) {
                currentClient.timeLimit = 150;
            } else if (currentClient.age > 50) {
                currentClient.timeLimit = 240;
            } else {
                currentClient.timeLimit = 300;
            }

            clearSelections();
            updateClientDisplay();
        }

        // --- è¡¨ç¤ºæ›´æ–°ï¼ˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰ ---
        function updateClientDisplay() {
            document.getElementById('clientDetails').innerHTML = `
                <div class="client-detail"><strong>æ°å:</strong> ${currentClient.name}</div>
                <div class="client-detail"><strong>å¹´é½¢:</strong> ${currentClient.age}æ­³ (${currentClient.gender})</div>
                <div class="client-detail"><strong>ä¸»è¨´/ç›®æ¨™:</strong> ${currentClient.goal}</div>
                <div class="client-medical-info">
                    <h4><span style="font-size: 1.2em;">âš•ï¸</span> è¨ºæ–­ãƒ»ç¾ç—…æ­´</h4>
                    <p>${currentClient.condition.name}</p>
                    <small>${currentClient.condition.notes || ""}</small>
                </div>
                <div class="client-notes">
                    <h4><span style="font-size: 1.2em;">ğŸ“</span> ãƒ‘ãƒ¼ã‚½ãƒŠãƒªãƒ†ã‚£ãƒ»ç”Ÿæ´»</h4>
                    <p>${currentClient.personality}</p>
                </div>
                <div class="client-detail" style="margin-top: 15px; color: var(--danger-color);">
                    <strong>é€±é–“ä¸Šé™:</strong> ${currentClient.timeLimit}åˆ†
                </div>
            `;
        }
        
        function renderWeeklyCalendar() {
            const container = document.getElementById('weeklyCalendar');
            container.innerHTML = '';
            dayNames.forEach((day, index) => {
                const dayColumn = document.createElement('div');
                dayColumn.className = 'day-column';
                if (day === selectedDay) dayColumn.classList.add('active');
                dayColumn.onclick = () => selectDay(day);

                const totalTime = weeklyProgram[day].reduce((sum, ex) => sum + ex.duration, 0);

                dayColumn.innerHTML = `
                    <div class="day-header">${dayDisplayNames[index]}</div>
                    <div class="day-exercises">
                        ${weeklyProgram[day].map((ex, i) => `
                            <div class="day-exercise-item" onclick="event.stopPropagation(); showExerciseDetails('${day}', ${i})">
                                <div>
                                    <div>${ex.name}</div>
                                    <small>(${ex.sets} ${ex.unit === 'å›' ? 'x' : ''} ${ex.reps})</small>
                                </div>
                                <span class="remove-btn" onclick="event.stopPropagation(); removeFromDay('${day}', ${i})">âœ•</span>
                            </div>
                        `).join('')}
                    </div>
                    <div class="day-time-total">${totalTime}åˆ†</div>
                `;
                container.appendChild(dayColumn);
            });
        }

        function renderExercisePool() {
            const container = document.getElementById('exercisePool');
            container.innerHTML = exercises.map(ex => `
                <div class="exercise-card" onclick="openModal(${ex.id})" tabindex="0">
                    <div class="exercise-name">${ex.name}</div>
                    <div class="exercise-type">${ex.type} / å¼·åº¦:${'â˜…'.repeat(ex.intensity)}</div>
                </div>
            `).join('');
        }

        function updateSummary(score = 0) {
            const totalTime = Object.values(weeklyProgram).flat().reduce((sum, ex) => sum + ex.duration, 0);
            
            const scoreDisplay = document.getElementById('scoreDisplay');
            scoreDisplay.textContent = score;
            scoreDisplay.className = 'value ';
            if (score >= 80) scoreDisplay.classList.add('score-excellent');
            else if (score >= 50) scoreDisplay.classList.add('score-good');
            else scoreDisplay.classList.add('score-poor');
            
            const timeDisplay = document.getElementById('totalTimeDisplay');
            timeDisplay.textContent = `${totalTime} åˆ†`;
            timeDisplay.style.color = totalTime > currentClient.timeLimit ? 'var(--danger-color)' : 'inherit';
        }

        function clearFeedback() {
             document.getElementById('feedback').innerHTML = `
                <p style="text-align: center; color: #7f8c8d;">ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã€ã€Œè©•ä¾¡ã‚’ä¾é ¼ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
            `;
            updateSummary();
        }

        // --- ãƒ—ãƒ­ã‚°ãƒ©ãƒ æ“ä½œ ---
        function selectDay(day) {
            selectedDay = day;
            renderWeeklyCalendar();
        }

        function addToDay(exerciseId, sets, reps) {
            if (!selectedDay) {
                alert('é‹å‹•ã‚’è¿½åŠ ã™ã‚‹æ›œæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            const exercise = exercises.find(e => e.id === exerciseId);
            const duration = Math.ceil(exercise.baseDuration * sets * reps / (exercise.unit === 'åˆ†' ? 1 : (exercise.unit === 'ç§’' ? 60 : 1)));
            
            weeklyProgram[selectedDay].push({ ...exercise, sets, reps, duration, originalId: exercise.id });
            closeModal();
            renderWeeklyCalendar();
            updateSummary();
        }

        function removeFromDay(day, index) {
            weeklyProgram[day].splice(index, 1);
            renderWeeklyCalendar();
            updateSummary();
        }

        // --- ãƒ¢ãƒ¼ãƒ€ãƒ«å‡¦ç† ---
        function openModal(exerciseId) {
            const exercise = exercises.find(e => e.id === exerciseId);
            document.getElementById('modalTitle').textContent = `${exercise.name} ã®è¨­å®š`;
            
            const form = document.getElementById('modalForm');
            form.innerHTML = `
                <div class="modal-form-group">
                    <label for="sets">ã‚»ãƒƒãƒˆæ•°</label>
                    <input type="number" id="sets" value="3" min="1">
                </div>
                <div class="modal-form-group">
                    <label for="reps">${exercise.unit}æ•°</label>
                    <input type="number" id="reps" value="10" min="1">
                </div>
            `;
            
            const confirmBtn = document.getElementById('modalConfirmBtn');
            confirmBtn.onclick = () => {
                const sets = document.getElementById('sets').value;
                const reps = document.getElementById('reps').value;
                addToDay(exerciseId, parseInt(sets), parseInt(reps));
            };
            
            document.getElementById('exerciseModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('exerciseModal').style.display = 'none';
        }
        
        function showExerciseDetails(day, index) {
            const ex = weeklyProgram[day][index];
            alert(
                `${ex.name} (${dayDisplayNames[dayNames.indexOf(day)]}æ›œæ—¥)\n` +
                `ã‚¿ã‚¤ãƒ—: ${ex.type}\n` +
                `å¼·åº¦: ${'â˜…'.repeat(ex.intensity)}\n` +
                `è¨­å®š: ${ex.sets}ã‚»ãƒƒãƒˆ Ã— ${ex.reps} ${ex.unit}\n` +
                `æ¨å®šæ™‚é–“: ${ex.duration}åˆ†`
            );
        }

        // --- è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯ ---
        function evaluateProgram() {
            let score = 100;
            let positiveFeedback = [];
            let negativeFeedback = [];
            const program = Object.values(weeklyProgram).flat();

            if (program.length === 0) {
                alert("é‹å‹•ãŒä¸€ã¤ã‚‚è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
                return;
            }

            // 1. åŸºæœ¬çš„ãªãƒã‚§ãƒƒã‚¯
            const totalTime = program.reduce((sum, ex) => sum + ex.duration, 0);
            const exerciseDays = dayNames.filter(day => weeklyProgram[day].length > 0).length;
            const restDays = 7 - exerciseDays;

            if (restDays === 0) {
                score -= 25;
                negativeFeedback.push("ä¼‘æ¯æ—¥ãŒã‚ã‚Šã¾ã›ã‚“ã€‚éåº¦ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã¯æ€ªæˆ‘ã‚„ç–²åŠ´ã®åŸå› ã¨ãªã‚Šã¾ã™ã€‚æœ€ä½1ã€œ2æ—¥ã®ä¼‘æ¯æ—¥ã‚’è¨­ã‘ã¾ã—ã‚‡ã†ã€‚");
            } else if (restDays < 2) {
                score -= 10;
                negativeFeedback.push("ä¼‘æ¯æ—¥ãŒ1æ—¥ã®ã¿ã§ã™ã€‚å¯èƒ½ã§ã‚ã‚Œã°ã‚‚ã†1æ—¥è¨­ã‘ã‚‹ã“ã¨ã§ã€ã‚ˆã‚ŠåŠ¹æœçš„ãªå›å¾©ãŒæœŸå¾…ã§ãã¾ã™ã€‚");
            } else if (restDays >= 2 && restDays <= 4) {
                score += 15;
                positiveFeedback.push(`ä¼‘æ¯æ—¥ãŒ${restDays}æ—¥è¨­å®šã•ã‚Œã¦ãŠã‚Šã€é‹å‹•ã¨å›å¾©ã®ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯å¥½ã§ã™ã€‚`);
            } else if (restDays > 4) {
                score -= 15;
                negativeFeedback.push(`é‹å‹•æ—¥æ•°ãŒ${exerciseDays}æ—¥ã¨å°‘ãªã‚ã§ã™ã€‚ç›®æ¨™é”æˆã®ãŸã‚ã€é€±3æ—¥ä»¥ä¸Šã®é‹å‹•ã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†ã€‚`);
            }
            
            if (totalTime > currentClient.timeLimit) {
                score -= 30;
                negativeFeedback.push(`é€±é–“ã®ç·é‹å‹•æ™‚é–“ãŒä¸Šé™ï¼ˆ${currentClient.timeLimit}åˆ†ï¼‰ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è² æ‹…ã‚’è€ƒæ…®ã—ã€æ™‚é–“ã‚’è¦‹ç›´ã—ã¦ãã ã•ã„ã€‚`);
            } else if (totalTime < currentClient.timeLimit * 0.5) {
                score -= 15;
                negativeFeedback.push(`é€±é–“ã®ç·é‹å‹•æ™‚é–“ãŒç›®æ¨™ï¼ˆ${currentClient.timeLimit}åˆ†ï¼‰ã«å¯¾ã—ã¦å°‘ãªã™ãã¾ã™ã€‚ã‚‚ã†å°‘ã—é‹å‹•é‡ã‚’å¢—ã‚„ã—ã¾ã—ã‚‡ã†ã€‚`);
            } else {
                positiveFeedback.push("é€±é–“ã®ç·é‹å‹•æ™‚é–“ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚");
            }
            
            // 2. é‹å‹•å†…å®¹ã®è©•ä¾¡
            const types = [...new Set(program.map(p => p.type))];
            if (types.includes("æœ‰é…¸ç´ ") && types.includes("ç­‹åŠ›") && types.includes("æŸ”è»Ÿæ€§")) {
                score += 20;
                positiveFeedback.push("æœ‰é…¸ç´ ãƒ»ç­‹åŠ›ãƒ»æŸ”è»Ÿæ€§ã®3è¦ç´ ãŒãƒãƒ©ãƒ³ã‚¹è‰¯ãå«ã¾ã‚Œã¦ãŠã‚Šã€éå¸¸ã«å„ªã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ã€‚");
            } else if (types.length < 2) {
                score -= 15;
                negativeFeedback.push("é‹å‹•ã®ç¨®é¡ãŒåã£ã¦ã„ã¾ã™ã€‚ç­‹ãƒˆãƒ¬ã¨æœ‰é…¸ç´ é‹å‹•ãªã©ã€è¤‡æ•°ã®ç¨®é¡ã®é‹å‹•ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚");
            }

            // 3. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç‰¹æ€§ã¨ã®é©åˆæ€§è©•ä¾¡
            program.forEach(ex => {
                // ç¦å¿Œäº‹é …ãƒã‚§ãƒƒã‚¯
                if (ex.contra.some(c => currentClient.condition.tags.includes(c))) {
                    score -= 25;
                    negativeFeedback.push(`ã€è¦æ³¨æ„ã€‘${ex.name}ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®${currentClient.condition.name}ã«å¯¾ã—ã¦ç¦å¿Œï¼ˆé¿ã‘ã‚‹ã¹ãï¼‰ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`);
                }
                
                // å¼·åº¦ãƒã‚§ãƒƒã‚¯
                if (currentClient.age > 70 && ex.intensity > 1) {
                    score -= 5;
                    negativeFeedback.push(`é«˜é½¢ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å¯¾ã—ã€${ex.name}ã¯å¼·åº¦ãŒå°‘ã—é«˜ã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã‚ˆã‚Šå®‰å…¨ãªç¨®ç›®ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚`);
                }
            });

            // ç›®æ¨™é”æˆã¸ã®è²¢çŒ®åº¦
            if (currentClient.goal === "æ¸›é‡" && !types.includes("æœ‰é…¸ç´ ")) {
                score -= 10;
                negativeFeedback.push("æ¸›é‡ãŒç›®æ¨™ã§ã™ãŒã€ä¸­å¿ƒã¨ãªã‚‹æœ‰é…¸ç´ é‹å‹•ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
            }
            if (currentClient.goal === "ç­‹åŠ›å‘ä¸Š" && !types.includes("ç­‹åŠ›")) {
                score -= 10;
                negativeFeedback.push("ç­‹åŠ›å‘ä¸ŠãŒç›®æ¨™ã§ã™ãŒã€ç­‹åŠ›ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
            }

            // 4. æœ€çµ‚ã‚¹ã‚³ã‚¢èª¿æ•´ã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º
            score = Math.max(0, Math.min(120, score)); // ã‚¹ã‚³ã‚¢ã‚’0-120ã®ç¯„å›²ã«
            
            const feedbackContainer = document.getElementById('feedback');
            let feedbackHTML = '';
            
            if (positiveFeedback.length > 0) {
                feedbackHTML += '<div class="feedback-section positive"><h4>ğŸ‘ è‰¯ã„ç‚¹</h4>';
                positiveFeedback.forEach(fb => feedbackHTML += `<div class="feedback-item positive">${fb}</div>`);
                feedbackHTML += '</div>';
            }
            if (negativeFeedback.length > 0) {
                feedbackHTML += '<div class="feedback-section negative"><h4>âš ï¸ ç¢ºèªãƒ»æ”¹å–„ç‚¹</h4>';
                negativeFeedback.forEach(fb => feedbackHTML += `<div class="feedback-item negative">${fb}</div>`);
                feedbackHTML += '</div>';
            }

            if (feedbackHTML === '') {
                feedbackHTML = '<div class="feedback-section positive"><h4>ğŸ‰ ç´ æ™´ã‚‰ã—ã„ï¼</h4><div class="feedback-item positive">ç‰¹ç­†ã™ã¹ãå•é¡Œç‚¹ã¯ãªãã€éå¸¸ã«ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸç´ æ™´ã‚‰ã—ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã™ã€‚</div></div>';
            }
            
            feedbackContainer.innerHTML = feedbackHTML;
            updateSummary(score);
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã®è¿½åŠ 
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('exerciseModal').style.display === 'flex') {
                closeModal();
            }
        });

        // --- ã‚²ãƒ¼ãƒ é–‹å§‹ ---
        window.onload = initGame;
    </script>
</body>
</html>